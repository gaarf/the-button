{"version":3,"sources":["plumbing/style.ts","plumbing/toaster.ts","containers/TheButton/InfoPanel.tsx","plumbing/index.ts","containers/TheButton/index.tsx","containers/TheButton/getWeb3.tsx","components/Layout.tsx","App.tsx","index.tsx"],"names":["aesthetic","TypeStyleAesthetic","TypeStyle","autoGenerateTag","csstips","registerTheme","color","bg","text","font","family","size","unit","border","mixin","body","backgroundColor","fontFamily","fontSize","ThemeProviderImpl","children","changeTheme","React","createElement","ThemeProvider","useStyles","useStylesFactory","useThemeFactory","AppToaster","Toaster","create","position","Position","BOTTOM_RIGHT","showToast","message","props","key","show","InfoPanel","count","singular","isYou","ethCost","waitTime","lastParticipant","age","info","attachToBottom","borderTop","padding","marginRight","styles","cx","className","Number","round","href","rel","target","TheButton","useState","api","setApi","setInfo","loading","setLoading","error","setError","event","setEvent","useEffect","web3","window","ethereum","reload","location","Promise","resolve","reject","a","async","autoRefreshOnNetworkChange","on","enable","Web3","currentProvider","Error","getWeb3","then","result","eth","getAccounts","account","contract","Contract","ButtonABI","subscribe","_","block","hash","number","intent","icon","events","allEvents","transactionHash","clearSubscriptions","m","split","all","map","method","methods","call","cost","expired","utils","fromWei","canClaim","progressValue","gameAfoot","gameLost","isOpen","onConfirm","undefined","title","value","large","disabled","onClick","from","claim_treasure","send","press_button","Spinner","SIZE_SMALL","Layout","container","newLayer","vertical","horizontallyCenterChildren","borderBottom","paddingTop","flex","centerCenter","margin","App","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.b4ca3235.chunk.js","sourcesContent":["import React from \"react\";\nimport { StyleSheetDefinition } from \"aesthetic\";\nimport TypeStyleAesthetic from \"aesthetic-adapter-typestyle\";\nimport {\n  useStylesFactory,\n  useThemeFactory,\n  ThemeProvider\n} from \"aesthetic-react\";\nimport { TypeStyle } from \"typestyle\";\nimport * as csstips from \"csstips\";\n\ntype Mixins = { [key in keyof typeof csstips]: any };\n\ninterface Theme {\n  color: {\n    bg: string;\n    text: string;\n  };\n  font: {\n    family: string;\n    size: string | number;\n  };\n  border: string;\n  unit: number;\n  mixin: Mixins;\n}\n\nconst aesthetic = new TypeStyleAesthetic<Theme>(\n  new TypeStyle({ autoGenerateTag: true })\n);\n\ncsstips.setupPage('#root');\ncsstips.normalize();\n\naesthetic.registerTheme(\n  \"default\",\n  {\n    color: {\n      bg: \"white\",\n      text: \"#111\"\n    },\n    font: {\n      family: \"sans-serif\",\n      size: 14\n    },\n    unit: 8,\n    border: '1px solid #CCC',\n    mixin: csstips as Mixins\n  },\n  ({ color, font }: Theme) => ({\n    \"@global\": {\n      body: {\n        backgroundColor: color.bg,\n        fontFamily: font.family,\n        fontSize: font.size,\n        color: color.text\n      }\n    }\n  })\n);\n\nexport default aesthetic;\n\nexport const ThemeProviderImpl: React.FC = ({ children }) => {\n  aesthetic.changeTheme(\"default\");\n  return React.createElement(ThemeProvider, { aesthetic, children: children! });\n};\n\nexport type StyleSheet = StyleSheetDefinition<Theme, any>;\n\nexport const useStyles = useStylesFactory(aesthetic);\nexport const useTheme = useThemeFactory(aesthetic);\n","import { Position, Toaster, IToastProps } from \"@blueprintjs/core\";\n\nexport const AppToaster = Toaster.create({\n  position: Position.BOTTOM_RIGHT\n});\n\nexport function showToast(\n  message: string,\n  props?: Omit<IToastProps, \"message\">,\n  key?: string\n) {\n  AppToaster.show({ message, ...props }, key);\n}\n","import React from \"react\";\nimport { useStyles, plural } from \"../../plumbing\";\nimport { Tag } from \"@blueprintjs/core\";\nimport { InfoProps } from \"./types\";\n\nconst InfoPanel: React.FC<InfoProps> = ({\n  isYou,\n  waitTime,\n  ethCost,\n  lastParticipant,\n  age\n}) => {\n  const [styles, cx] = useStyles(({ border, mixin, color, unit }) => ({\n    info: {\n      ...mixin.attachToBottom,\n      backgroundColor: color.bg,\n      borderTop: border,\n      padding: unit,\n      \"@selectors\": {\n        \"> ul > li > *\": {\n          marginRight: unit\n        }\n      }\n    }\n  }));\n\n  return (\n    <div className={cx(styles.info)}>\n      <ul className={cx(\"bp3-list-unstyled\", \"bp3-running-text\")}>\n        <li>\n          <strong>Cost:</strong>\n          <span>{ethCost}</span>\n        </li>\n        {Number(lastParticipant) > 0 && (\n          <li>\n            <strong>Last Participant:</strong>\n            {isYou && <Tag round>YOU!</Tag>}\n            <a\n              href={`https://rinkeby.etherscan.io/address/${lastParticipant}`}\n              rel=\"noopener noreferrer\"\n              target=\"_blank\"\n            >\n              <code>{lastParticipant}</code>\n            </a>\n            <span>{plural(age, \"block\")} ago</span>\n          </li>\n        )}\n      </ul>\n    </div>\n  );\n};\n\nexport default InfoPanel;\n","export * from \"./style\";\nexport * from \"./toaster\";\n\n\nexport function plural(count: number, singular: string): string {\n  return `${count} ${singular}${count !== 1 ? \"s\" : \"\"}`;\n}\n","import React, { useEffect, useState } from \"react\";\nimport {\n  Button,\n  Alert,\n  Spinner,\n  ProgressBar,\n  Callout\n} from \"@blueprintjs/core\";\n\nimport InfoPanel from \"./InfoPanel\";\nimport { Api, InfoProps } from \"./types\";\nimport { showToast } from \"../../plumbing\";\nimport { getWeb3 } from \"./getWeb3\";\n\nimport ButtonABI from \"./Button.json\";\nimport { Log } from \"web3-core\";\n\nconst ButtonAddress = \"0x4D83de30Ba3c1779288adda0f1C6078Ac7c3238f\";\n\nconst TheButton: React.FC = () => {\n  const [api, setApi] = useState<Api>();\n  const [info, setInfo] = useState<InfoProps>();\n  const [loading, setLoading] = useState<boolean>(false);\n  const [error, setError] = useState<Error>();\n  const [event, setEvent] = useState<string>();\n\n  useEffect(() => {\n    let web3: Api[\"web3\"];\n\n    getWeb3()\n      .then(result => (web3 = result), setError)\n      .then(async () => {\n        if(!web3) return;\n\n        const [account] = await web3.eth.getAccounts();\n        const contract = new web3.eth.Contract(ButtonABI, ButtonAddress);\n        setApi({\n          web3,\n          account,\n          contract\n        });\n\n        web3.eth.subscribe(\"newBlockHeaders\", (_, block) => {\n          setEvent(block.hash);\n          showToast(`New block #${block.number}`, {\n            intent: \"none\",\n            icon: \"code-block\"\n          });\n        });\n\n        contract.events.allEvents((_: Error, { transactionHash }: Log) => {\n          setEvent(transactionHash);\n          showToast(\"Something happened!\", {\n            intent: \"warning\",\n            icon: \"warning-sign\"\n          });\n        });\n      });\n\n    return () => {\n      if (web3) {\n        web3.eth.clearSubscriptions(() => true);\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    if (api) {\n      const m = \"COST,WAIT_TIME,expired,lastParticipant,age\".split(\",\");\n      Promise.all(m.map(method => api.contract.methods[method]().call())).then(\n        ([cost, waitTime, expired, lastParticipant, age]) => {\n          setInfo({\n            cost,\n            ethCost: `${api.web3.utils.fromWei(cost, \"ether\")} ETH`,\n            age: Number(age),\n            waitTime: Number(waitTime),\n            expired,\n            lastParticipant,\n            isYou: lastParticipant === api.account\n          });\n        }\n      );\n    }\n  }, [api, event]);\n\n  const canClaim = info?.expired && info.isYou;\n\n  const handleClick = async () => {\n    const { contract, account: from } = api!;\n\n    setLoading(true);\n\n    try {\n      if (canClaim) {\n        await contract.methods.claim_treasure().send({ from });\n        showToast(\"You got the prize!\", {\n          intent: \"success\",\n          icon: \"download\"\n        });\n        setLoading(false);\n        return;\n      }\n      await contract.methods.press_button().send({ from, value: info!.cost });\n    } catch (e) {\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const progressValue = info && info.age / (info.waitTime + 1);\n  const gameAfoot = info?.isYou && Number(progressValue) < 1;\n  const gameLost = info?.expired && !info.isYou;\n\n  return (\n    <>\n      <Alert\n        intent=\"danger\"\n        isOpen={!!error}\n        onConfirm={() => setError(undefined)}\n      >\n        {error && error.message}\n      </Alert>\n\n      {info && (\n        <>\n          {gameAfoot ? (\n            <Callout\n              title={`Please wait ${info.waitTime} blocks`}\n              intent=\"primary\"\n            >\n              <p>If nobody else clicks the button during that time, you win.</p>\n              <ProgressBar value={progressValue} />\n            </Callout>\n          ) : (\n            <Button\n              large\n              disabled={loading || gameLost}\n              onClick={handleClick}\n              intent={canClaim ? \"success\" : \"none\"}\n              icon={loading && <Spinner size={Spinner.SIZE_SMALL} />}\n            >\n              {loading\n                ? \"Standby...\"\n                : canClaim\n                ? \"Click to claim!\"\n                : gameLost\n                ? \"Winner must claim\"\n                : \"Click to play!\"}\n            </Button>\n          )}\n          <InfoPanel {...info} />\n        </>\n      )}\n    </>\n  );\n};\n\nexport default TheButton;\n","import Web3 from \"web3\";\n\nexport function getWeb3(): Promise<Web3> {\n  // @ts-ignore\n  const { ethereum, web3 } = window;\n\n  const reload = () => window.location.reload(true);\n\n  return new Promise(async (resolve, reject) => {\n    if (ethereum) {\n      ethereum.autoRefreshOnNetworkChange = false;\n      ethereum.on(\"networkChanged\", reload);\n      ethereum.on(\"accountsChanged\", reload);\n      await ethereum.enable();\n      resolve(new Web3(ethereum));\n    }\n    else if (web3) {\n      // Acccounts always exposed\n      resolve(new Web3(web3.currentProvider));\n    }\n    // Non-dapp browsers...\n    else {\n      reject(new Error(`Please install and enable MetaMask!`));\n    }\n  });\n}\n","import React from \"react\";\nimport { useStyles } from \"../plumbing\";\nimport TheButton from \"../containers/TheButton\";\n\nexport default function Layout() {\n  const [styles, cx] = useStyles(({ unit, border, mixin }) => ({\n    container: {\n      ...mixin.newLayer,\n      ...mixin.vertical,\n      \"@selectors\": {\n        \"> header\": {\n          ...mixin.horizontallyCenterChildren,\n          borderBottom: border,\n          paddingTop: unit\n        },\n        \"> main\": {\n          ...mixin.flex,\n          ...mixin.centerCenter,\n          margin: 'auto',\n          padding: unit\n        }\n      }\n    }\n  }));\n\n  return (\n    <div className={cx(styles.container)}>\n      <header>\n        <h3 className={cx('bp3-heading')}>The Button</h3>\n      </header>\n\n      <main>\n        <TheButton />\n      </main>\n    </div>\n  );\n}\n","import React from \"react\";\nimport { ThemeProviderImpl } from \"./plumbing\";\nimport Layout from \"./components/Layout\";\n\nimport \"@blueprintjs/core/lib/css/blueprint.css\";\nimport \"@blueprintjs/icons/lib/css/blueprint-icons.css\";\n\nconst App: React.FC = () => {\n  return (\n    <ThemeProviderImpl>\n      <Layout />\n    </ThemeProviderImpl>\n  );\n};\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}